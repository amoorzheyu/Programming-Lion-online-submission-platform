<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>å­¦ç”Ÿè¡¥è¯¾ä¿¡æ¯ç™»è®°</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f6f8;
        margin: 0;
        padding: 0;
        overflow-y: hidden;
      }

      html,
      body {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .top-bar {
        height: 80px;
        flex-shrink: 0;
        padding: 20px;
        background-color: #fff;
        display: flex;
        justify-content: flex-start;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }
      .add-button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
      }
      .add-button:hover {
        background-color: #218838;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .modal.show {
        display: flex;
        opacity: 1;
      }

      .modal-content {
        background-color: #fff;
        padding: 30px;
        border-radius: 16px;
        width: 95%;
        max-width: 700px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        transform: scale(0.95);
        transition: transform 0.3s ease;
      }

      .modal.show .modal-content {
        transform: scale(1);
      }

      form label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
      }
      .date-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .date-info {
        font-size: 14px;
        color: #555;
      }

      input[type="text"],
      input[type="date"] {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-top: 5px;
        background-color: #fff;
        background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 18px;
        appearance: none;
      }

      .submit-button {
        margin-top: 25px;
        padding: 12px 24px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }
      .submit-button:hover {
        background-color: #0056b3;
      }

      .content {
        padding: 20px;
        display: flex;
        justify-content: center;
      }
      .entry-list {
        max-height: calc(80%);
        overflow-y: auto;
        width: 100%;
        max-width: 600px;
      }

      .entry {
        background-color: #fff;
        border-left: 4px solid #007bff;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        position: relative;
      }

      .entry_complete {
        border-left: 4px solid #ccc;
      }
      .entry .header-text {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
      }

      .header-text {
        position: sticky;
        top: 0;
        z-index: 10; /* å¿…é¡»å¤Ÿé«˜ï¼Œç¡®ä¿ç›–åœ¨å†…å®¹ä¸Š */
        padding: 12px 10px;
        border-bottom: 1px solid #eee;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        cursor: pointer;
      }

      .entry .details {
        font-size: 14px;
        border-top: 1px solid #ddd;
        padding-top: 8px;
        margin-top: 6px;
        color: #333;
      }

      .completed {
        background-color: #f0f0f0;
        color: #777;
        border-left-color: #999;
      }
      .collapsed .details {
        display: none;
      }
      .toggle {
        cursor: pointer;
        color: #007bff;
        text-decoration: underline;
        font-size: 14px;
        margin-top: 10px;
      }

      #completed-entries.collapsed {
        display: none;
      }

      input[type="date"] {
        width: 100%;
        padding: 14px 18px;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-top: 5px;
        background-color: #fff;
        background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="30" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 30px;
        appearance: none;
        font-size: 20px; /* â¬…ï¸ æ”¾å¤§å­—ä½“ */
        height: 55px; /* â¬…ï¸ æ”¾å¤§è¾“å…¥æ¡†é«˜åº¦ */
        line-height: 1.5;
        zoom: 1.2; /* â¬…ï¸ æœ‰äº›æµè§ˆå™¨ä¼šåŒæ­¥æ”¾å¤§å¼¹å‡ºæ—¥å† */
      }
      #incomplete-entries,
      #completed-entries {
        transition: all 0.3s ease;
        max-height: calc(80%);
      }
      .content.row {
        flex: 1;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: flex-start;
        padding: 20px;
        gap: 20px;
        height: 100%; /* ğŸ‘ˆ å…³é”®ç‚¹ï¼šè‡ªåŠ¨å æ»¡å‰©ä½™ç©ºé—´ */
      }

      .entry-list-wrapper {
        flex: 1;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        height: 100%; /* âœ… ä¿è¯èƒ½å æ»¡å®¹å™¨é«˜åº¦ */
      }

      .entry-list {
        flex: 1; /* âœ… è‡ªåŠ¨æ’‘æ»¡å‰©ä¸‹ç©ºé—´ */
        overflow-y: auto;
        padding-right: 6px;
      }

      /* ç¾åŒ–æ»šåŠ¨æ¡ */
      .entry-list::-webkit-scrollbar {
        width: 8px;
      }
      .entry-list::-webkit-scrollbar-track {
        background: #f0f0f0;
        border-radius: 4px;
      }
      .entry-list::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 4px;
      }
      .entry-list::-webkit-scrollbar-thumb:hover {
        background: #999;
      }

      .entry + .entry {
        margin-top: 15px;
      }

      .sticky-header {
        position: sticky;
        top: 0;
        background-color: #fff;
        z-index: 10;
        padding: 12px 16px;
        border-bottom: 1px solid #ddd;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        cursor: pointer;
      }

      #incomplete-entries.collapsed {
        display: none;
      }
      .completed {
        background-color: #f0f0f0;
        border-left-color: #999;
      }

      .completed,
      .completed * {
        color: #777 !important;
      }

      /* ç¾åŒ–â€œæ ‡è®°ä¸ºå·²å®Œæˆâ€åŒºåŸŸ */
      .details label {
        display: flex;
        align-items: center;
        font-size: 16px;
        margin-top: 10px;
        gap: 10px;
        cursor: pointer;
      }

      /* æ”¾å¤§å¤é€‰æ¡† */
      .details input[type="checkbox"].complete-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #28a745; /* âœ”ï¸ç»¿è‰²é£æ ¼å¤é€‰æ¡† */
      }

      /* å¯é€‰ï¼šè®©å‹¾é€‰çŠ¶æ€æ›´æ˜¾çœ¼ */
      .details input[type="checkbox"]:checked + span {
        color: #28a745;
        font-weight: bold;
      }

      .delete-button {
        position: absolute;
        top: 8px;
        right: -10px;
        background-color: transparent;
        border: none;
        color: #dc3545;
        font-size: 25px;
        cursor: pointer;
      }

      .delete-button:hover {
        color: #a71d2a;
      }

      .autocomplete-items {
        position: absolute;
        border: 1px solid #ccc;
        border-top: none;
        z-index: 99;
        background-color: white;
        max-height: 200px;
        overflow-y: auto;
        width: 80%;
        border-radius: 0 0 6px 6px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .autocomplete-items div {
        padding: 10px;
        cursor: pointer;
      }

      .autocomplete-items div:hover,
      .autocomplete-active {
        background-color: rgb(0, 166, 237);
        color: white;
      }
      .app-title {
        font-size: 22px;
        font-weight: bold;
        color: #333;
        margin-right: 30px;
        align-self: center;
      }

      #incomplete-entries header-tex{
        background-color: white;
      }

      #completed-entries header-tex{
        background-color: #F0F0F0;
      }


    </style>
  </head>
  <body>
    <div class="top-bar">
      <div class="app-title">ğŸ¦ ç¼–ç¨‹ç‹®è¡¥è¯¾ç™»è®°ç³»ç»Ÿ</div>
      <button class="add-button" onclick="openModal()">â• æ·»åŠ è¡¥è¯¾è®°å½•</button>
    </div>
    

    <div class="content row">
      <!-- æœªå®Œæˆè®°å½• -->
      <div class="entry-list-wrapper">
        <div class="header-text sticky-header" onclick="toggleIncompleteList()">
          â¬‡ï¸ æœªå®Œæˆè®°å½•ï¼ˆç‚¹å‡»å±•å¼€/æ”¶èµ·ï¼‰
        </div>
        <div class="entry-list">
          <div id="incomplete-entries" class=""></div>
        </div>
      </div>

      <!-- å·²å®Œæˆè®°å½• -->
      <div class="entry-list-wrapper">
        <div class="header-text sticky-header" onclick="toggleCompletedList()">
          â¬‡ï¸ å·²å®Œæˆè®°å½•ï¼ˆç‚¹å‡»å±•å¼€/æ”¶èµ·ï¼‰
        </div>
        <div class="entry-list">
          <div id="completed-entries" class=""></div>
        </div>
      </div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-content">
        <form id="tutoring-form">
          <label class="date-label">
            è¯·å‡æ—¥æœŸï¼ˆé»˜è®¤ä»Šå¤©ï¼‰:
            <span class="date-info" id="leave-info"></span>
          </label>
          <input type="date" id="leave-date" />

          <label
            >å­¦ç”Ÿå§“å:
            <input type="text" id="student-name" required />
            <div id="autocomplete-list" class="autocomplete-items"></div>
          </label>

          <label class="date-label">
            è¡¥è¯¾æ—¥æœŸï¼ˆé»˜è®¤æ˜å¤©ï¼‰:
            <span class="date-info" id="makeup-info"></span>
          </label>
          <input type="date" id="makeup-date" required />

          <button type="submit" class="submit-button">ğŸ’¾ ä¿å­˜è¡¥è¯¾è®°å½•</button>
        </form>
      </div>
    </div>

    <script>
      const STORAGE_KEY = "makeupRecords";

      const leaveInput = document.getElementById("leave-date");
      const makeupInput = document.getElementById("makeup-date");
      const leaveInfo = document.getElementById("leave-info");
      const makeupInfo = document.getElementById("makeup-info");
      const form = document.getElementById("tutoring-form");
      const modal = document.getElementById("modal");
      const entriesDiv = document.getElementById("entries");
      const incompleteContainer = document.getElementById("incomplete-entries");
      const completedContainer = document.getElementById("completed-entries");

      const studentList = [
        "ä½™ä¿Šç¿¼",
        "é™†æ²›æ—",
        "é»„æ¢“æ¶µ",
        "è‹ä¿å",
        "å½­é›„æ™–",
        "æ¨æ¢“æ‚¦",
        "æ…æ¢“ç¿",
        "ç½—è€€éš†",
        "æœç¿è°¦",
        "å­™é“±è¾°",
        "é™¶å…ƒé’¦",
        "é»„ç†™ç²¤",
        "èƒ¡å“²æ¶µ",
        "å¾è¿œæ¶µ",
        "æ¨æ”¿",
        "è‚å¯é¦¨",
        "é™ˆæ³½æ˜Š",
        "é™ˆå°‘å®—",
        "æ—å† å»·",
        "å®‹æµ©æ‰¬",
        "å§œå¸Œæ°",
        "è°¢é“ çƒ¨",
        "è°¢é“ ç£Š",
        "æ—ä¿Šæ¼©",
        "éƒ‘åšé˜³",
        "é‚“æ™¯ç‘",
      ];

      function openModal() {
        const modal = document.getElementById("modal");
        modal.classList.add("show");
      }

      function closeModal() {
        const modal = document.getElementById("modal");
        modal.classList.remove("show");
      }

      function toggleIncompleteList() {
        incompleteContainer.classList.toggle("collapsed");
      }

      function toggleCompletedList() {
        completedContainer.classList.toggle("collapsed");
      }

      function getWeekCategory(dateStr) {
        const parseLocalDate = (str) => {
          const [year, month, day] = str.split("-").map(Number);
          return new Date(year, month - 1, day); // é¿å…æ—¶åŒºåå·®
        };

        const inputDate = parseLocalDate(dateStr);
        inputDate.setHours(0, 0, 0, 0);

        const now = new Date();
        now.setHours(0, 0, 0, 0);

        const currentDay = now.getDay();
        const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay;
        const baseMonday = new Date(now);
        baseMonday.setDate(now.getDate() + mondayOffset);
        baseMonday.setHours(0, 0, 0, 0);

        const ONE_WEEK = 7 * 24 * 60 * 60 * 1000;
        const baseTime = baseMonday.getTime();
        const labels = [
          "æ›´ä¹…ä»¥å‰",
          "ä¸Šäº”å‘¨",
          "ä¸Šå››å‘¨",
          "ä¸Šä¸‰å‘¨",
          "ä¸Šä¸¤å‘¨",
          "ä¸Šå‘¨",
          "æœ¬å‘¨",
          "ä¸‹å‘¨",
          "ä¸‹ä¸¤å‘¨",
          "ä¸‹ä¸‰å‘¨",
          "ä¸‹å››å‘¨",
          "ä¸‹äº”å‘¨",
          "æ›´ä¹…ä»¥å",
        ];
        const weeks = Array.from(
          { length: labels.length }, // â¬…ï¸ æ”¹è¿™é‡Œ
          (_, i) => new Date(baseTime + (i - 5) * ONE_WEEK)
        );

        for (let i = 0; i < 12; i++) {
          if (inputDate >= weeks[i] && inputDate < weeks[i + 1]) {
            return labels[i + 1];
          }
        }

        if (inputDate < weeks[0]) return labels[0];
        if (inputDate >= weeks[12]) return labels[12];
      }

      function formatDateWithWeekday(dateStr, more) {
        const date = new Date(dateStr);
        const weekdays = [
          "æ˜ŸæœŸæ—¥",
          "æ˜ŸæœŸä¸€",
          "æ˜ŸæœŸäºŒ",
          "æ˜ŸæœŸä¸‰",
          "æ˜ŸæœŸå››",
          "æ˜ŸæœŸäº”",
          "æ˜ŸæœŸå…­",
        ];
        if (more) {
          return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ ${
            weekdays[date.getDay()]
          }`;
        } else {
          return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
        }
      }

      function updateDateInfo(inputEl, infoEl, more = true) {
        const val = inputEl.value;
        if (!val) return (infoEl.textContent = "");
        infoEl.textContent = `${formatDateWithWeekday(
          val,
          more
        )}ï¼ˆ${getWeekCategory(val)}ï¼‰`;
      }

      function saveToStorage(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      function loadFromStorage() {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : [];
      }

      function renderEntries() {
        completedContainer.innerHTML = "";
        incompleteContainer.innerHTML = "";

        loadFromStorage().forEach((record, index) => {
          const entry = document.createElement("div");
          entry.className = "entry collapsed ";
          if (record.completed) entry.classList.add("completed");

          entry.innerHTML = `
 <div class="header-text">
  ${record.studentName} - è¡¥è¯¾ï¼š${formatDateWithWeekday(
            record.makeupDate,
            true
          )} ${getWeekCategory(record.makeupDate)}
  <button class="delete-button" title="åˆ é™¤æ­¤æ¡è®°å½•">ğŸ—‘</button>
</div>

<div class="details details-hidden">
  è¯·å‡æ—¥æœŸï¼š${formatDateWithWeekday(record.leaveDate, true)} ${getWeekCategory(
            record.leaveDate
          )}<br />
  <label>
    <input type="checkbox" class="complete-checkbox" ${
      record.completed ? "checked" : ""
    }/>
    <span>æ ‡è®°ä¸ºå·²å®Œæˆ</span>
  </label>
</div>

  <div class="toggle">[å±•å¼€/æŠ˜å ]</div>
    `;

          // åˆ‡æ¢æŠ˜å /å±•å¼€
          entry.querySelector(".toggle").onclick = () =>
            entry.classList.toggle("collapsed");

          // å¤é€‰æ¡†æ“ä½œ
          entry.querySelector(".complete-checkbox").onchange = (e) => {
            record.completed = e.target.checked;
            const all = loadFromStorage();
            all[index] = record;
            saveToStorage(all);
            renderEntries();
          };

          // åˆ é™¤æŒ‰é’®äº‹ä»¶
          entry.querySelector(".delete-button").onclick = () => {
            if (confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) {
              const all = loadFromStorage();
              all.splice(index, 1); // åˆ é™¤å½“å‰è®°å½•
              saveToStorage(all);
              renderEntries();
            }
          };

          (record.completed
            ? completedContainer
            : incompleteContainer
          ).appendChild(entry);
        });
      }

      form.onsubmit = (e) => {
        e.preventDefault();
        const leaveDate = leaveInput.value;
        const studentName = document
          .getElementById("student-name")
          .value.trim();
        const makeupDate = makeupInput.value;
        if (!leaveDate || !studentName || !makeupDate)
          return alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼");
        const newRecord = {
          leaveDate,
          studentName,
          makeupDate,
          completed: false,
        };
        const records = loadFromStorage();
        records.push(newRecord);
        saveToStorage(records);
        renderEntries();
        form.reset();
        setDefaultDates();
        closeModal();
      };

      modal.onclick = (e) => {
        if (e.target === modal) closeModal();
      };

      function setDefaultDates() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        leaveInput.valueAsDate = today;
        makeupInput.valueAsDate = tomorrow;
        updateDateInfo(leaveInput, leaveInfo);
        updateDateInfo(makeupInput, makeupInfo);
      }

      document.addEventListener("click", function (e) {
        const isInput = e.target === studentInput;
        const isItem = autoDiv.contains(e.target);
        if (!isInput && !isItem) {
          autoDiv.innerHTML = "";
        }
      });

      const studentInput = document.getElementById("student-name");
      const autoDiv = document.getElementById("autocomplete-list");

      let currentFocus = -1;

      studentInput.addEventListener("input", function () {
        const val = this.value.trim().toLowerCase();
        autoDiv.innerHTML = "";
        currentFocus = -1;
        if (!val) return;

        const matched = studentList.filter((name) =>
          name.toLowerCase().includes(val)
        );

        matched.forEach((name) => {
          const item = document.createElement("div");
          item.textContent = name;
          item.onclick = () => {
            studentInput.value = name;
            autoDiv.innerHTML = "";
          };
          autoDiv.appendChild(item);
        });
      });

      studentInput.addEventListener("keydown", function (e) {
        const items = autoDiv.querySelectorAll("div");
        if (!items.length) return;

        if (e.key === "ArrowDown") {
          currentFocus++;
          setActive(items);
        } else if (e.key === "ArrowUp") {
          currentFocus--;
          setActive(items);
        } else if (e.key === "Enter") {
          e.preventDefault();
          if (currentFocus > -1 && items[currentFocus]) {
            items[currentFocus].click();
          }
        }
      });
      function setActive(items) {
        if (!items.length) return;

        // ä¿®æ­£è¾¹ç•Œ
        if (currentFocus >= items.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = items.length - 1;

        items.forEach((item, i) => {
          item.classList.toggle("autocomplete-active", i === currentFocus);
        });

        // è‡ªåŠ¨æ»šåŠ¨å½“å‰é¡¹åˆ°å¯è§åŒºåŸŸ
        items[currentFocus]?.scrollIntoView({ block: "nearest" });
      }

      leaveInput.onchange = () => updateDateInfo(leaveInput, leaveInfo);
      makeupInput.onchange = () => updateDateInfo(makeupInput, makeupInfo);

      setDefaultDates();
      renderEntries();

      let lastRenderedDate = new Date().toDateString();

      setInterval(() => {
        const nowDateStr = new Date().toDateString();
        if (nowDateStr !== lastRenderedDate) {
          lastRenderedDate = nowDateStr;
          setDefaultDates(); // é‡æ–°è®¾å®šé»˜è®¤æ—¥æœŸ
        }
        renderEntries();
      }, 60 * 60 * 1000);
    </script>
  </body>
</html>
